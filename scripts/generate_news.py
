import json, requests, os
from datetime import datetime

HF_API_KEY = os.getenv("HF_API_KEY")
API_URL = "https://api-inference.huggingface.co/models/gpt2"

def query(prompt):
    headers = {"Authorization": f"Bearer {HF_API_KEY}"}
    payload = {"inputs": prompt, "max_length": 300}
    response = requests.post(API_URL, headers=headers, json=payload)
    try:
        return response.json()[0]['generated_text']
    except:
        return "Ошибка генерации"

def generate_news():
    articles = []
    for i in range(5):
        title = query("Сгенерируй короткий заголовок новости про ИИ на русском")
        content = query(f"Напиши новостную статью по заголовку: {title}")
        image_url = f"https://placehold.co/600x400?text=News+{i+1}"  # потом заменим на генератор картинок
        articles.append({
            "title": title.strip(),
            "content": content.strip(),
            "imageUrl": image_url,
            "date": datetime.now().isoformat()
        })
    with open("news.json", "w", encoding="utf-8") as f:
        json.dump(articles, f, ensure_ascii=False, indent=2)

if __name__ == "__main__":
    generate_news()
